services:
  # ROS1 Base Image
  roscore:
    image: ros:noetic-ros-core
    restart: always
    command: roscore
    network_mode: host
    environment:
      - ROS_MASTER_URI=http://master:11311
      - ROS_HOSTNAME=master

  firmware:
    # To Build Locally uncomment the following
    build:
      context: ./firmware
      dockerfile: Dockerfile
    image: tortoisebot-ros1-firmware-real   
    # To Pull Image Remotely
    # image: tianyaoh501679/tianyaoh-cp22:tortoisebot-ros1-slam-real
    hostname: tortoisebot-ros1-firmware
    network_mode: host
    cap_add:
      - SYS_RAWIO
    security_opt:
      - "no-new-privileges:true"
    privileged: true
    command: bash -c "source devel/setup.bash && roslaunch tortoisebot_firmware bringup.launch"
    devices:
      - "/dev/mem:/dev/mem"
      - "/dev/ttyUSB0:/dev/ttyUSB0"
      - "/dev/video0:/dev/video0"
    environment:
      - ROS_MASTER_URI=http://master:11311
      - ROS_HOSTNAME=master

  slam: 
    # To Build Locally uncomment the following
    build:
      context: ./mapping
      dockerfile: Dockerfile
    image: tortoisebot-ros1-slam-real
    # To Pull Image Remotely
    # image: tianyaoh501679/tianyaoh-cp22:tortoisebot-ros1-slam-real
    hostname: tortoisebot-ros1-slam
    restart: always
    depends_on:
      - firmware
    command: bash -c "roslaunch tortoisebot_slam mapping.launch"
    network_mode: host
    environment:
      - DISPLAY
      - ROS_MASTER_URI=http://master:11311
      - ROS_HOSTNAME=master
    volumes:
      - /home/tortoisebot/.Xauthority:/root/.Xauthority 


